#!/usr/bin/env ruby

require 'date'
require 'moped'

uri = ENV['MONGO_URL'] || 'mongodb://bam:bam@10.11.12.27'

%w[issue_stage issue_production].each do |name|
  db = Moped::Session.connect("#{uri}/#{name}")

  collection = db[:people]
  collection.insert(name: 'LaRouche')
  doc = collection.find(name: 'LaRouche').one

  if doc['name'] == 'LaRouche'
    puts "#{uri} is functional"
  else
    puts "#{uri} is broken"
  end

  collection.drop
end
